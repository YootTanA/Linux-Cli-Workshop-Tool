#!/bin/bash

# Default ENV settings
TARGET_DIR=/home
QUEST_NAME=$1
REPORT_FILE=./quest-report/"$QUEST_NAME.csv"
TMP_REPORT_FILE=./quest-report/"TMP-$QUEST_NAME.csv"


if [ -z "$1" ]; then
  echo "Please provide a quest name."
  exit 1
fi

for dir in $TARGET_DIR/*; do 
   if [ -d "$dir" ]; then
     user=$(basename "$dir")
   else
     break
   fi

   if [[ $user == user-* ]]; then
     test_result=$(./quest-solution/$QUEST_NAME/test-suite $user)
     echo "$user,$test_result" >> $REPORT_FILE
   fi
done

sort -V $REPORT_FILE > $TMP_REPORT_FILE
mv $TMP_REPORT_FILE $REPORT_FILE

