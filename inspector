#!/bin/bash

# Default ENV settings
TARGET_DIR=/home
QUEST_NAME=$1
REPORT_FILE=./quest-report/"$QUEST_NAME.csv"

if [ -z "$1" ]; then
  echo "Please provide a quest name."
  exit 1
fi

# Clear previous state
rm -f $REPORT_FILE

for dir in $TARGET_DIR/*; do 
   if [ -d "$dir" ]; then
     user=$(basename "$dir")
   else
     break
   fi

   if [[ $user == user-* ]]; then
     test_result=$(./quest-solution/$QUEST_NAME/test-suite $user)
     echo "$user,$test_result" >> $REPORT_FILE
   fi
done

sort -V $REPORT_FILE -o $REPORT_FILE
